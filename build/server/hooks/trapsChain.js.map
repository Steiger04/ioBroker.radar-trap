{
  "version": 3,
  "sources": ["../../../src/server/hooks/trapsChain.ts"],
  "sourcesContent": ["import { differenceBy, mergeWith, intersectionBy, flatten, reduce } from \"lodash\";\n\nimport type { Feature, Point, LineString } from \"@turf/helpers\";\n\nconst trapsChain = <\n\tT extends radarTrap.Poi | radarTrap.Poly,\n\tF extends Feature<Point | LineString, T> = Feature<Point | LineString, T>,\n>(\n\trecord = {} as Record<string, F[]>,\n\tresult = {} as Record<string, F[]>,\n): {\n\tnewTraps: Record<string, F[]>;\n\testablishedTraps: Record<string, F[]>;\n\trejectedTraps: Record<string, F[]>;\n\ttraps: Record<string, F[]>;\n\tnewTrapsReduced: Record<string, F[]>;\n\trejectedTrapsReduced: Record<string, F[]>;\n} => {\n\tconst newTraps = mergeWith({ ...record }, result, (recordValue, resultValue) =>\n\t\tdifferenceBy<F, F>(resultValue, recordValue || [], \"properties.backend\").map((item) => ({\n\t\t\t...item,\n\t\t\tproperties: { ...item.properties, status: \"NEW\" },\n\t\t})),\n\t) as Record<string, F[]>;\n\t// if (process.env.NODE_ENV === \"development\") console.log(\"newTraps >>>\", newTraps);\n\n\tconst establishedTraps = mergeWith({ ...record }, result, (recordValue, resultValue) =>\n\t\tintersectionBy<F, F>(recordValue || [], resultValue, \"properties.backend\").map((item) => ({\n\t\t\t...item,\n\t\t\tproperties: { ...item.properties, status: \"ESTABLISHED\" },\n\t\t})),\n\t) as Record<string, F[]>;\n\t// if (process.env.NODE_ENV === \"development\") console.log(\"establishedTraps >>>\", establishedTraps);\n\n\tconst rejectedTraps = mergeWith({ ...record }, result, (recordValue, resultValue) =>\n\t\tdifferenceBy<F, F>(recordValue || [], resultValue, \"properties.backend\").map((item) => ({\n\t\t\t...item,\n\t\t\tproperties: { ...item.properties, status: \"REJECTED\" },\n\t\t})),\n\t) as Record<string, F[]>;\n\t// if (process.env.NODE_ENV === \"development\") console.log(\"rejectedTraps >>>\", rejectedTraps);\n\n\tconst traps = mergeWith({ ...establishedTraps }, newTraps, (objValue, srcValue) =>\n\t\tflatten<F>([objValue, srcValue]),\n\t) as Record<string, F[]>;\n\t// if (process.env.NODE_ENV === \"development\") console.log(\"traps >>>\", traps);\n\n\tconst newTrapsReduced = reduce(\n\t\tnewTraps,\n\t\tfunction (acc, value) {\n\t\t\tacc.trapsNew.push(...value);\n\t\t\treturn acc;\n\t\t},\n\t\t{ trapsNew: [] } as unknown as Record<string, F[]>,\n\t);\n\t// if (process.env.NODE_ENV === \"development\") console.log(\"newTrapsReduced >>>\", newTrapsReduced);\n\n\tconst rejectedTrapsReduced = reduce(\n\t\trejectedTraps,\n\t\tfunction (acc, value) {\n\t\t\tacc.trapsRejected.push(...value);\n\n\t\t\treturn acc;\n\t\t},\n\t\t{ trapsRejected: [] } as unknown as Record<string, F[]>,\n\t);\n\t// if (process.env.NODE_ENV === \"development\") console.log(\"rejectedTrapsReduced >>>\", rejectedTrapsReduced);\n\n\treturn { traps, newTraps, establishedTraps, rejectedTraps, newTrapsReduced, rejectedTrapsReduced };\n};\n\nexport { trapsChain };\n"],
  "mappings": ";;;;;;;;;;;;;;;;;;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,oBAAyE;AAIzE,MAAM,aAAa,CAIlB,SAAS,CAAC,GACV,SAAS,CAAC,MAQN;AACJ,QAAM,eAAW;AAAA,IAAU,EAAE,GAAG,OAAO;AAAA,IAAG;AAAA,IAAQ,CAAC,aAAa,oBAC/D,4BAAmB,aAAa,eAAe,CAAC,GAAG,oBAAoB,EAAE,IAAI,CAAC,UAAU;AAAA,MACvF,GAAG;AAAA,MACH,YAAY,EAAE,GAAG,KAAK,YAAY,QAAQ,MAAM;AAAA,IACjD,EAAE;AAAA,EACH;AAGA,QAAM,uBAAmB;AAAA,IAAU,EAAE,GAAG,OAAO;AAAA,IAAG;AAAA,IAAQ,CAAC,aAAa,oBACvE,8BAAqB,eAAe,CAAC,GAAG,aAAa,oBAAoB,EAAE,IAAI,CAAC,UAAU;AAAA,MACzF,GAAG;AAAA,MACH,YAAY,EAAE,GAAG,KAAK,YAAY,QAAQ,cAAc;AAAA,IACzD,EAAE;AAAA,EACH;AAGA,QAAM,oBAAgB;AAAA,IAAU,EAAE,GAAG,OAAO;AAAA,IAAG;AAAA,IAAQ,CAAC,aAAa,oBACpE,4BAAmB,eAAe,CAAC,GAAG,aAAa,oBAAoB,EAAE,IAAI,CAAC,UAAU;AAAA,MACvF,GAAG;AAAA,MACH,YAAY,EAAE,GAAG,KAAK,YAAY,QAAQ,WAAW;AAAA,IACtD,EAAE;AAAA,EACH;AAGA,QAAM,YAAQ;AAAA,IAAU,EAAE,GAAG,iBAAiB;AAAA,IAAG;AAAA,IAAU,CAAC,UAAU,iBACrE,uBAAW,CAAC,UAAU,QAAQ,CAAC;AAAA,EAChC;AAGA,QAAM,sBAAkB;AAAA,IACvB;AAAA,IACA,SAAU,KAAK,OAAO;AACrB,UAAI,SAAS,KAAK,GAAG,KAAK;AAC1B,aAAO;AAAA,IACR;AAAA,IACA,EAAE,UAAU,CAAC,EAAE;AAAA,EAChB;AAGA,QAAM,2BAAuB;AAAA,IAC5B;AAAA,IACA,SAAU,KAAK,OAAO;AACrB,UAAI,cAAc,KAAK,GAAG,KAAK;AAE/B,aAAO;AAAA,IACR;AAAA,IACA,EAAE,eAAe,CAAC,EAAE;AAAA,EACrB;AAGA,SAAO,EAAE,OAAO,UAAU,kBAAkB,eAAe,iBAAiB,qBAAqB;AAClG;",
  "names": []
}
