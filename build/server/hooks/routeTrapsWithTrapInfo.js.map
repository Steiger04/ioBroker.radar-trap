{
  "version": 3,
  "sources": ["../../../src/server/hooks/routeTrapsWithTrapInfo.ts"],
  "sourcesContent": ["import polyline from \"@mapbox/polyline\";\nimport { feature, featureCollection } from \"@turf/helpers\";\nimport { uniqWith } from \"lodash\";\nimport { addTrapInfoToTrapProperties } from \"./addTrapInfoToTrapProperties\";\nimport { LineString, Point } from \"@turf/turf\";\n\nconst routeTrapsWithTrapInfo = (data: radarTrap.Route): void => {\n\tif (data.directions === undefined) {\n\t\treturn;\n\t}\n\n\tdata.directions = data.directions!.map((rec) => {\n\t\tconst directionFeature = feature<LineString, radarTrap.Poi>(polyline.toGeoJSON(rec.direction.geometry));\n\n\t\trec.direction.directionFeature = directionFeature;\n\n\t\tif (rec.routeTrapsNew !== undefined) addTrapInfoToTrapProperties(rec.routeTrapsNew);\n\t\tif (rec.routeTrapsEstablished !== undefined) addTrapInfoToTrapProperties(rec.routeTrapsEstablished);\n\t\tif (rec.routeTrapsRejected !== undefined) addTrapInfoToTrapProperties(rec.routeTrapsRejected);\n\n\t\treturn rec;\n\t});\n\n\tconst directionsFeatureCollection = featureCollection<Point | LineString, radarTrap.Poi>(\n\t\tdata.directions.map((rec) => rec.direction.directionFeature!),\n\t);\n\n\tdata.directionsFeatureCollection = directionsFeatureCollection;\n\n\tconst polyLinesFeatureCollection = featureCollection<LineString, radarTrap.Poly>(\n\t\tdata.directions.flatMap((rec) => rec.polyLineFeatures!),\n\t);\n\n\tdata.polyLinesFeatureCollection = polyLinesFeatureCollection;\n\n\tlet allTraps = data.directions.flatMap(({ routeTraps }) => addTrapInfoToTrapProperties(routeTraps!));\n\n\tallTraps = uniqWith(allTraps, (a, b) => {\n\t\tif (a.properties.schemaType === \"POI\" && b.properties.schemaType === \"POI\") {\n\t\t\tif (\n\t\t\t\t!a.properties.linetrap &&\n\t\t\t\t!b.properties.linetrap &&\n\t\t\t\ta.properties.lat === b.properties.lat &&\n\t\t\t\ta.properties.lng === b.properties.lng\n\t\t\t) {\n\t\t\t\treturn true;\n\t\t\t}\n\n\t\t\tif (\n\t\t\t\ta.properties.linetrap &&\n\t\t\t\tb.properties.linetrap &&\n\t\t\t\ta.properties.lat === b.properties.lat &&\n\t\t\t\ta.properties.lng === b.properties.lng\n\t\t\t) {\n\t\t\t\treturn true;\n\t\t\t}\n\t\t}\n\n\t\treturn false;\n\t});\n\n\tdata.trapsFeatureCollection = featureCollection(allTraps);\n};\n\nexport { routeTrapsWithTrapInfo };\n"],
  "mappings": ";;;;;;;;;;;;;;;;;;;;;;;;;;;;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,sBAAqB;AACrB,qBAA2C;AAC3C,oBAAyB;AACzB,yCAA4C;AAG5C,MAAM,yBAAyB,CAAC,SAAgC;AAC/D,MAAI,KAAK,eAAe,QAAW;AAClC;AAAA,EACD;AAEA,OAAK,aAAa,KAAK,WAAY,IAAI,CAAC,QAAQ;AAC/C,UAAM,uBAAmB,wBAAmC,gBAAAA,QAAS,UAAU,IAAI,UAAU,QAAQ,CAAC;AAEtG,QAAI,UAAU,mBAAmB;AAEjC,QAAI,IAAI,kBAAkB;AAAW,0EAA4B,IAAI,aAAa;AAClF,QAAI,IAAI,0BAA0B;AAAW,0EAA4B,IAAI,qBAAqB;AAClG,QAAI,IAAI,uBAAuB;AAAW,0EAA4B,IAAI,kBAAkB;AAE5F,WAAO;AAAA,EACR,CAAC;AAED,QAAM,kCAA8B;AAAA,IACnC,KAAK,WAAW,IAAI,CAAC,QAAQ,IAAI,UAAU,gBAAiB;AAAA,EAC7D;AAEA,OAAK,8BAA8B;AAEnC,QAAM,iCAA6B;AAAA,IAClC,KAAK,WAAW,QAAQ,CAAC,QAAQ,IAAI,gBAAiB;AAAA,EACvD;AAEA,OAAK,6BAA6B;AAElC,MAAI,WAAW,KAAK,WAAW,QAAQ,CAAC,EAAE,WAAW,UAAM,gEAA4B,UAAW,CAAC;AAEnG,iBAAW,wBAAS,UAAU,CAAC,GAAG,MAAM;AACvC,QAAI,EAAE,WAAW,eAAe,SAAS,EAAE,WAAW,eAAe,OAAO;AAC3E,UACC,CAAC,EAAE,WAAW,YACd,CAAC,EAAE,WAAW,YACd,EAAE,WAAW,QAAQ,EAAE,WAAW,OAClC,EAAE,WAAW,QAAQ,EAAE,WAAW,KACjC;AACD,eAAO;AAAA,MACR;AAEA,UACC,EAAE,WAAW,YACb,EAAE,WAAW,YACb,EAAE,WAAW,QAAQ,EAAE,WAAW,OAClC,EAAE,WAAW,QAAQ,EAAE,WAAW,KACjC;AACD,eAAO;AAAA,MACR;AAAA,IACD;AAEA,WAAO;AAAA,EACR,CAAC;AAED,OAAK,6BAAyB,kCAAkB,QAAQ;AACzD;",
  "names": ["polyline"]
}
