{
  "version": 3,
  "sources": ["../../../src/server/hooks/convertPolylineToGeojson.ts"],
  "sourcesContent": ["import polyline from \"@mapbox/polyline\";\nimport { feature, featureCollection } from \"@turf/helpers\";\nimport { uniqWith } from \"lodash\";\nimport { prepareTraps } from \"./prepareTraps\";\n\nconst convertPolylineToGeojson = (data: radarTrap.Route): void => {\n\tif (data.directions === undefined) {\n\t\treturn;\n\t}\n\n\tdata.directions = data.directions!.map((rec) => {\n\t\tconst directionFeature = feature(\n\t\t\tpolyline.toGeoJSON(rec.direction.geometry),\n\t\t) as GeoJSON.Feature<GeoJSON.LineString>;\n\n\t\trec.direction.directionFeature = directionFeature;\n\n\t\treturn rec;\n\t});\n\n\tconst directionsFeatureCollection = featureCollection(\n\t\tdata.directions.map((rec) => rec.direction.directionFeature!),\n\t);\n\n\tdata.directionsFeatureCollection = directionsFeatureCollection;\n\n\tlet allTraps = data.directions.flatMap(({ routeTraps }) => prepareTraps(routeTraps!));\n\n\tallTraps = uniqWith(allTraps, (a, b) => {\n\t\tif (\n\t\t\t!a.properties?.linetrap &&\n\t\t\t!b.properties?.linetrap &&\n\t\t\ta.properties?.lat === b.properties?.lat &&\n\t\t\ta.properties?.lng === b.properties?.lng\n\t\t) {\n\t\t\treturn true;\n\t\t}\n\n\t\tif (\n\t\t\ta.properties?.linetrap &&\n\t\t\tb.properties?.linetrap &&\n\t\t\ta.properties.lat === b.properties.lat &&\n\t\t\ta.properties.lng === b.properties.lng\n\t\t) {\n\t\t\treturn true;\n\t\t}\n\n\t\treturn false;\n\t});\n\n\tconst trapsFeatureCollection = featureCollection(allTraps);\n\n\tdata.trapsFeatureCollection = trapsFeatureCollection;\n};\n\nexport { convertPolylineToGeojson };\n"],
  "mappings": ";;;;;;;;;;;;;;;;;;;;;;;;;;;;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,sBAAqB;AACrB,qBAA2C;AAC3C,oBAAyB;AACzB,0BAA6B;AAE7B,MAAM,2BAA2B,CAAC,SAAgC;AACjE,MAAI,KAAK,eAAe,QAAW;AAClC;AAAA,EACD;AAEA,OAAK,aAAa,KAAK,WAAY,IAAI,CAAC,QAAQ;AAC/C,UAAM,uBAAmB;AAAA,MACxB,gBAAAA,QAAS,UAAU,IAAI,UAAU,QAAQ;AAAA,IAC1C;AAEA,QAAI,UAAU,mBAAmB;AAEjC,WAAO;AAAA,EACR,CAAC;AAED,QAAM,kCAA8B;AAAA,IACnC,KAAK,WAAW,IAAI,CAAC,QAAQ,IAAI,UAAU,gBAAiB;AAAA,EAC7D;AAEA,OAAK,8BAA8B;AAEnC,MAAI,WAAW,KAAK,WAAW,QAAQ,CAAC,EAAE,WAAW,UAAM,kCAAa,UAAW,CAAC;AAEpF,iBAAW,wBAAS,UAAU,CAAC,GAAG,MAAM;AA5BzC;AA6BE,QACC,GAAC,OAAE,eAAF,mBAAc,aACf,GAAC,OAAE,eAAF,mBAAc,eACf,OAAE,eAAF,mBAAc,WAAQ,OAAE,eAAF,mBAAc,UACpC,OAAE,eAAF,mBAAc,WAAQ,OAAE,eAAF,mBAAc,MACnC;AACD,aAAO;AAAA,IACR;AAEA,UACC,OAAE,eAAF,mBAAc,eACd,OAAE,eAAF,mBAAc,aACd,EAAE,WAAW,QAAQ,EAAE,WAAW,OAClC,EAAE,WAAW,QAAQ,EAAE,WAAW,KACjC;AACD,aAAO;AAAA,IACR;AAEA,WAAO;AAAA,EACR,CAAC;AAED,QAAM,6BAAyB,kCAAkB,QAAQ;AAEzD,OAAK,yBAAyB;AAC/B;",
  "names": ["polyline"]
}
